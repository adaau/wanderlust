app.controller('BookmarkCtrl', ['$scope', 'BookmarkFactory', '$stateParams', '$auth', function($scope, BookmarkFactory, $stateParams, $auth){
  console.log('BookmarkCtrl');

  var url = "<%= ENV['URL'] %>" || "http://localhost:3000";

  $scope.isCreating = false

  // INDEX
  // $scope.getAllBookmarks = function(){
    BookmarkFactory.query(function(response){
      console.log(response);
      $scope.bookmarks = response;
      getBookmarkLists();
      console.log($scope.monthCategoryList)
    })

  // CREATE
  $scope.createBookmark = function() {
    BookmarkFactory.save($scope.newBookmark, function(newBookmark) {
      console.log(newBookmark);
      $scope.bookmarks.push(newBookmark);
      $scope.submissionSuccess = true;
      resetBookmarkForm();
    });
  }

  // DELETE
  $scope.deleteBookmark = function(category, bookmarkIndex) {
    var bookmarkId = $scope.monthCategoryList[category][bookmarkIndex].id;
    BookmarkFactory.delete({ id: bookmarkId}, function(response){
      console.log(response);
      $scope.monthCategoryList[category].splice(bookmarkIndex, 1);
    });
  }

  function getBookmarkLists() {
    $scope.monthCategoryList = {}
    $scope.bookmarks.forEach(function(bookmark){
      if ($scope.monthCategoryList[bookmark.list]) {
        $scope.monthCategoryList[bookmark.list].push(bookmark)
      }
      else {
        $scope.monthCategoryList[bookmark.list] = [ bookmark ];
      }
    });
  }

  function getMonthNumber(monthCategoryList) {
    return ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"].indexOf(bookmark.list) + 1;
  }

  function resetBookmarkForm() {
    $scope.newBookmark = {
      list: '',
      comment: '',
      place_id: $stateParams.id
    }
  }

  function startCreating() {
    $scope.isCreating = true;
    resetBookmarkForm();
  }

  function cancelCreating() {
    $scope.isCreating = false;
    resetBookmarkForm();
  }

  $scope.startCreating = startCreating;
  $scope.cancelCreating = cancelCreating;
}])
